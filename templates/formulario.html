{% extends 'base.html' %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-5 col-md-8">
        
        <div class="text-center mb-4">
            <h2 class="fw-bold">{% if producto %} Editar Perfume {% else %} Registrar Nuevo {% endif %}</h2>
            <p class="text-muted">Completa los detalles del producto</p>
        </div>

        <div class="card p-4 p-md-5 border-0 shadow-lg">
            <form method="POST" action="{{ url_for('guardar_producto') }}" enctype="multipart/form-data">
                
                <!-- ESTE ES EL CAMPO NUEVO -->
                <input type="hidden" name="origen" value="{{ origen if origen else '' }}">
                
                <input type="hidden" name="id_producto" value="{{ producto[0] if producto else '' }}">

                <!-- Nombre -->
                <div class="mb-4">
                    <label>Nombre del Perfume</label>
                    <input type="text" name="nombre" class="form-control form-control-lg" placeholder="Ej: Chanel No. 5" value="{{ producto[1] if producto else '' }}" required>
                </div>

                <!-- Marca y Género -->
                <div class="row mb-4">
                    <div class="col-6">
                        <label>Marca</label>
                        <input type="text" name="marca" class="form-control" placeholder="Ej: Dior" value="{{ producto[2] if producto else '' }}">
                    </div>
                    <div class="col-6">
                        <label>Género</label>
                        <input type="text" name="genero" class="form-control" placeholder="Ej: Hombre / Mujer / Unisex" value="{{ producto[6] if producto else '' }}">
                    </div>
                </div>

                <!-- Descripción -->
                <div class="mb-4">
                    <label>Descripción</label>
                    <textarea name="descripcion" class="form-control" rows="3" placeholder="Notas, estilo, etc.">{{ producto[3] if producto else '' }}</textarea>
                </div>

                <!-- Precio, Stock y Ml -->
                <div class="row mb-4">
                    <div class="col-4">
                        <label>Precio ($)</label>
                        <input type="number" step="0.01" name="precio" class="form-control" placeholder="0.00" value="{{ producto[4] if producto else '' }}" required>
                    </div>
                    <div class="col-4">
                        <label>Stock Inicial</label>
                        <input type="number" name="stock" class="form-control" placeholder="0" value="{{ producto[5] if producto else '' }}" required>
                    </div>
                    <div class="col-4">
                        <label>Mililitros (ml)</label>
                        <input type="number" name="mililitros" class="form-control" placeholder="100" value="{{ producto[7] if producto else '' }}">
                    </div>
                </div>

                <div class="mb-4 form-check">
                    <input class="form-check-input" type="checkbox" name="estado" id="estadoActivo" {% if not producto or producto[9] == 1 %}checked{% endif %}>
                    <label class="form-check-label" for="estadoActivo">Activo</label>
                </div>

                <div class="mb-5">
                    <label class="form-label">Imagen del Perfume</label>
                    <input type="file" name="imagen" class="form-control" accept="image/*">
                    {% if producto and producto[8] %} <div class="mt-2">
                            <small class="text-muted">Imagen actual:</small><br>
                            {% set img_path = producto[8] %}
                            {% if '/' not in img_path %}
                                {% set img_path = 'img/perfumes/' ~ img_path %}
                            {% endif %}
                            <img src="{{ url_for('static', filename=img_path) }}" alt="Perfume" style="height: 80px; border-radius: 5px; border: 1px solid #ddd;">
                        </div>
                    {% endif %}
                </div>

                <!-- Botones -->
                <div class="d-grid gap-3">
                    <button type="submit" class="btn btn-gold py-3">
                        {% if producto %} GUARDAR CAMBIOS {% else %} CREAR PRODUCTO {% endif %}
                    </button>
                    <a href="{{ url_for('dashboard') }}" class="btn btn-light py-2 text-muted">Cancelar y Volver</a>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}
